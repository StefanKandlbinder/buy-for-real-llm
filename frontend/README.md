# Buy For Real - Frontend

This is the frontend for the "Buy For Real" application. It's a [Next.js](https://nextjs.org/) project using a [tRPC](https://trpc.io/) backend, a [PostgreSQL](https://www.postgresql.org/) database with [Drizzle ORM](https://orm.drizzle.team/), and [Clerk](https://clerk.com/) for authentication.

## Tech Stack

- **Framework:** [Next.js](https://nextjs.org/) (with App Router & Turbopack)
- **API:** [tRPC](https://trpc.io/) & Next.js Server Actions
- **Database:** [PostgreSQL](https://www.postgresql.org/) (via [Neon](https://neon.tech/))
- **ORM:** [Drizzle ORM](https://orm.drizzle.team/)
- **Authentication:** [Clerk](https://clerk.com/)
- **Styling:** [Tailwind CSS](https://tailwindcss.com/)
- **UI Components:** [Shadcn UI](https://ui.shadcn.com/)
- **Schema Validation:** [Zod](https://zod.dev/)
- **State Management:** [React Query](https://tanstack.com/query/v5)

## Project Architecture

This project follows a strict convention of using **tRPC for all database-related API communication**. Standard Next.js API routes (`/app/api/route.ts`) are disallowed to maintain a consistent and type-safe API layer.

For operations that require `FormData`, such as file uploads, **Next.js Server Actions** are used. These actions handle the multipart data and then call the tRPC API internally using the server-side caller for database operations, thus respecting the architectural rules.

## Project Structure

- `src/app`: Contains the main application pages and layouts.
- `src/actions`: Contains all Next.js Server Actions.
- `src/components`: Contains reusable React components.
- `src/db`: Contains the Drizzle ORM schema and database connection.
- `src/trpc`: Contains the tRPC server and client implementation.
- `drizzle`: Contains the database migration files generated by Drizzle Kit.

## Error Handling System

This application features a comprehensive error handling system that provides meaningful user feedback through toast notifications while maintaining a great user experience even when things go wrong.

### Components

#### 1. Global Error Page (`src/app/error.tsx`)

- **Purpose**: Catches server-side and Next.js routing errors at the application level
- **Features**:
  - Automatically shows toast notifications with user-friendly error messages
  - Provides retry and navigation options
  - Handles common error types (UNAUTHORIZED, NOT_FOUND, network errors, etc.)
  - Includes error IDs for debugging in production

#### 2. React ErrorBoundary (`src/components/ErrorBoundary.tsx`)

- **Purpose**: Catches JavaScript errors in React components during rendering
- **Features**:
  - Automatic toast notifications for component errors
  - Fallback UI with recovery options
  - Development-friendly error details
  - Customizable fallback components
  - `useErrorHandler` hook for manual error reporting

#### 3. Error Provider (`src/components/ErrorProvider.tsx`)

- **Purpose**: Provides consistent error reporting context throughout the application
- **Features**:
  - `reportError()`, `reportWarning()`, and `reportInfo()` functions
  - Smart error message transformation for better UX
  - Context-aware error descriptions
  - `useAsyncErrorHandler` hook for async operations

#### 4. Demo Component (`src/components/ErrorBoundaryDemo.tsx`)

- **Purpose**: Interactive demonstration and testing of error handling capabilities
- **Features**: Test different error scenarios and see usage examples

### Integration with Toast System

The error handling system seamlessly integrates with the existing [Sonner](https://sonner.emilkowal.ski/) toast system:

- **Consistent UI**: All error notifications use the same toast component
- **Theme-Aware**: Toasts respect the application's dark/light theme
- **Action Buttons**: Error toasts include retry, refresh, or navigation actions
- **Duration Control**: Different error types have appropriate display durations

### Usage Examples

#### Basic Error Reporting

```typescript
import { useErrorReporting } from "@/components/ErrorProvider";

function MyComponent() {
  const { reportError } = useErrorReporting();

  const handleAsyncOperation = async () => {
    try {
      await someApiCall();
    } catch (error) {
      reportError(error as Error, "Failed to load data");
    }
  };
}
```

#### Component Error Boundaries

```typescript
import ErrorBoundary from "@/components/ErrorBoundary";

function MyPage() {
  return (
    <ErrorBoundary>
      <ComponentThatMightError />
    </ErrorBoundary>
  );
}
```

#### Manual Error Handling

```typescript
import { useErrorHandler } from "@/components/ErrorBoundary";

function MyComponent() {
  const errorHandler = useErrorHandler();

  const handleError = () => {
    const error = new Error("Custom error message");
    errorHandler(error);
  };
}
```

### Error Message Intelligence

The system automatically transforms technical errors into user-friendly messages:

- **Network Errors**: "Network error. Please check your internet connection."
- **Authentication**: "You need to sign in to continue."
- **Authorization**: "You don't have permission to perform this action."
- **Validation**: "Please check your input and try again."
- **File Upload**: "File is too large. Please choose a smaller file."
- **Generic Fallback**: Sanitized versions of original error messages

### Benefits

- **Enhanced UX**: Users see helpful error messages instead of technical jargon
- **Error Recovery**: Built-in retry and navigation options
- **Developer Experience**: Detailed error information in development mode
- **Production Safety**: Sanitized error messages in production
- **Consistent Design**: All errors follow the same visual and interaction patterns
- **Contextual Information**: Errors include relevant context about what operation failed

## Getting Started

### Prerequisites

- Node.js
- pnpm
- A PostgreSQL database (e.g., from [Neon](https://neon.tech/))

### Installation & Setup

1.  **Install dependencies:**

    ```bash
    pnpm install
    ```

2.  **Set up environment variables:**
    Create a `.env.local` file by copying the `.env.example` file. Add the necessary environment variables, including your `DATABASE_URL` and credentials for Clerk and Pinata.

3.  **Run database migrations:**
    ```bash
    pnpm db:generate
    pnpm db:migrate
    ```

### Running the Development Server

To start the development server, run:

```bash
pnpm dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

## Available Scripts

- `pnpm dev`: Starts the development server with Turbopack.
- `pnpm build`: Creates a production build of the application.
- `pnpm start`: Starts the production server.
- `pnpm lint`: Lints the codebase using Next.js's ESLint configuration.
- `pnpm db:generate`: Generates a new database migration based on schema changes.
- `pnpm db:migrate`: Applies pending database migrations.
- `pnpm db:studio`: Opens the Drizzle Studio to browse your database.

## Deployment on Vercel

This project is configured for continuous deployment on [Vercel](https://vercel.com/).

### CI/CD Pipeline

A GitHub Actions workflow is set up in `.github/workflows/vercel.yml` to automate the deployment process. The pipeline triggers on any push or pull request to the `main` branch and performs the following steps:

1.  **Checkout & Setup:** Checks out the code and sets up the Node.js environment.
2.  **Install Dependencies:** Installs project dependencies using `pnpm`.
3.  **Lint:** Runs the linter to ensure code quality.
4.  **Deploy:** Builds and deploys the project to Vercel. A preview deployment is created for pull requests, and a production deployment is made for pushes to `main`.

### Environment Variables

For the deployment to succeed, you must configure the following secrets in your GitHub repository settings (`Settings > Secrets and variables > Actions`):

- `VERCEL_ORG_ID`: Your Vercel organization ID.
- `VERCEL_PROJECT_ID`: The ID of the corresponding project on Vercel.
- `VERCEL_TOKEN`: A Vercel access token with deployment permissions.
- `DATABASE_URL`: The connection string for your production database.
- `PINATA_API_KEY`: Your Pinata API key.
- `PINATA_API_SECRET`: Your Pinata API secret.
- `PINATA_JWT`: Your Pinata JWT.
- `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`: Your Clerk publishable key.
- `CLERK_SECRET_KEY`: Your Clerk secret key.
